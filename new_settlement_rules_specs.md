Okay, I really need to rethink the whole settlement rules configuration. Specifically, actually, just how the client admin is saving settlement instructions. The basics that we have are more or less there, but upon looking at real examples, we need to restructure it significantly.

Let me give you the following specs, and we'll write out in detail. Then, bit by bit, I want us to start modifying first the front-end (the screens) and then, once we're happy with that, we can go on to the back-end with the API calls and, of course, saving it to the data model.

So the first part of the Edit/Add Rule page can remain as-is. First section is General Information, with Rule Name, Priority and Active checkbox all as mandatory fields. There should also be a field called “Direction” with a dropdown saying “Compra de Divisas” and “Venta de Divisas” (and their equivalents in the relevant locale files). We should also move the Product dropdown to be directly after the Counterparty dropdown. The Cashflow Currency field is no longer necessary. There should be a “Modalidad” dropdown. If the selected Product is Spot, then this should default to “Entrega Física” and it should not be possible to select “Compensación”. If the selected Product is Forward, then this should default to “Compensación” but it should be possible to select “Entrega Física”.

Then we should have a section called Account Details (and equivalent in other locales) which will be ordered differently based on whether the user selects “Compra de Divisas” and “Venta de Divisas”. If they select “Compra de Divisas” then there will be a sub-section that says “Cargar” (and equivalent in other locales) and the option to select currencies, bank name (only show banks with accounts in that currency as the application currently does), SWIFT code (only show SWIFT codes for banks with accounts in that currency as the application currently does) bank account number (only show accounts in that currency as the application currently does). Then another sub-section that says “Abonar” (and equivalent in other locales) and the option to select currencies, bank name (only show banks with accounts in that currency as the application currently does), bank account number (only show accounts in that currency as the application currently does).
Then there will be a final section called Central Bank Trade Code (and equivalent in other locales) with a single dropdown containing all of the central bank códigos de comercio.

Remember to consider all locales.

On the backend we should modify our existing Pydantic structures, APIs to save and read to the database, and database settlementRules collection (e.g. /clients/xyz-corp/settlementRules), without adding any new functionality beyond what is mentioned here.
